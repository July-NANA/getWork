# Shopee

---

- ▲ 10 进程和线程的区别与联系？

进程：操作系统会以进程为单位，分配系统资源（CPU 时间片、内存等资源），进程是资源分配的最小单位。

> 进程间通信（IPC）:
>
> - 管道(Pipe)、命名管道(FIFO)、消息队列(Message Queue) 、信号量(Semaphore) 、共享内存（Shared Memory）；套接字（Socket）。

线程：有时被称为轻量级进程(Lightweight Process，LWP），是操作系统调度（CPU 调度）执行的最小单位。

- 区别
  > - 调度：
        线程作为调度和分配的基本单位，进程作为拥有资源的基本单位；
  > - 并发性：
        不仅进程之间可以并发执行，同一个进程的多个线程之间也可并发执行；
  > - 拥有资源：
        进程是拥有资源的一个独立单位，线程不拥有系统资源
        进程所维护的是程序所包含的资源（静态资源）， 如：地址空间，打开的文件句柄集，文件系统状态，信号处理handler等；
        线程所维护的运行相关的资源（动态资源），如：运行栈，调度相关的控制信息，待处理的信号集等；
  > - 系统开销：
        在创建或撤消进程时，由于系统都要为之分配和回收资源，导致系统的开销明显大于创建或撤消线程时的开销。
        但是进程有独立的地址空间，一个进程崩溃后，在保护模式下不会对其它进程产生影响，
        而线程只是一个进程中的不同执行路径。
        线程有自己的堆栈和局部变量，但线程之间没有单独的地址空间，一个进程死掉就等于所有的线程死掉，
        所以多进程的程序要比多线程的程序健壮，但在进程切换时，耗费资源较大，效率要差一些。
- 联系
  > - 一个线程只能属于一个进程，而一个进程可以有多个线程，但至少有一个线程；
  > - 资源分配给进程，同一进程的所有线程共享该进程的所有资源；

![操作系统.jpg](http://5b0988e595225.cdn.sohucs.com/images/20180622/6765e36cc4604fba897976638af03524.jpeg "操作系统.jpg")

拓展

> - 协程:
>   协程，是一种比线程更加轻量级的存在，协程不是被操作系统内核所管理，而完全是由程序所控制（也就是在用户态执行）。这样带来的好处就是性能得到了很大的提升，不会像线程切换那样消耗资源。
>   一个线程就是执行一个子程序
>   协程在子程序内部是可中断的，然后转而执行别的子程序，在适当的时候再返回来接着执行。
>   > 优势:
>   > 极高的执行效率：因为子程序切换不是线程切换，而是由程序自身控制，因此，没有线程切换的开销，和多线程比，线程数量越多，协程的性能优势就越明显；
>   > 不需要多线程的锁机制，因为只有一个线程，也不存在同时写变量冲突，在协程中控制共享资源不加锁，只需要判断状态就好了，所以执行效率比多线程高很多。

---

- ▲ 7 进程通信中的管道实现原理是什么？

进程间通信的方式：

进程间通信主要包括管道、系统 IPC（包括消息队列、信号量、信号、共享内存等）、以及套接字 socket。

1.  管道：

    管道主要包括无名管道和命名管道:管道可用于具有亲缘关系的父子进程间的通信，有名管道除了具有管道所具有的功能外，它还允许无亲缘关系进程间的通信

    > 1.1 普通管道 PIPE：  
    > 1)它是半双工的（即数据只能在一个方向上流动），具有固定的读端和写端  
    > 2)它只能用于具有亲缘关系的进程之间的通信（也是父子进程或者兄弟进程之间）  
    > 3)它可以看成是一种特殊的文件，对于它的读写也可以使用普通的 read、write 等函数。但是它不是普通的文件，并不属于其他任何文件系统，并且只存在于内存中。

    > 1.2 命名管道 FIFO：
    > 1)FIFO 可以在无关的进程之间交换数据
    > 2)FIFO 有路径名与之相关联，它以一种特殊设备文件形式存在于文件系统中。

2.  系统 IPC：

    >     2.1 消息队列
    >
    > 消息队列，是消息的链接表，存放在内核中。一个消息队列由一个标识符（即队列 ID）来标记。 (消息队列克服了信号传递信息少，管道只能承载无格式字节流以及缓冲区大小受限等特点)具有写权限得进程可以按照一定得规则向消息队列中添加新信息；对消息队列有读权限得进程则可以从消息队列中读取信息;
    >
    > - 特点：  
    >    1)消息队列是面向记录的，其中的消息具有特定的格式以及特定的优先级。  
    >   2)消息队列独立于发送与接收进程。进程终止时，消息队列及其内容并不会被删除。  
    >    3)消息队列可以实现消息的随机查询,消息不一定要以先进先出的次序读取,也可以按消息的类型读取。

    >     2.2 信号量 semaphore
    >
    > 信号量（semaphore）与已经介绍过的 IPC 结构不同，它是一个计数器，可以用来控制多个进程对共享资源的访问。信号量用于实现进程间的互斥与同步，而不是用于存储进程间通信数据。
    >
    > - 特点：  
    >   1)信号量用于进程间同步，若要在进程间传递数据需要结合共享内存。  
    >   2)信号量基于操作系统的 PV 操作，程序对信号量的操作都是原子操作。  
    >   3)每次对信号量的 PV 操作不仅限于对信号量值加 1 或减 1，而且可以加减任意正整数。  
    >   4)支持信号量组。

2.3 信号 signal

信号是一种比较复杂的通信方式，用于通知接收进程某个事件已经发生。

2.4 共享内存（Shared Memory）

它使得多个进程可以访问同一块内存空间，不同进程可以及时看到对方进程中对共享内存中数据得更新。这种方式需要依靠某种同步操作，如互斥锁和信号量等

特点：

1)共享内存是最快的一种 IPC，因为进程是直接对内存进行存取

2)因为多个进程可以同时操作，所以需要进行同步

3)信号量+共享内存通常结合在一起使用，信号量用来同步对共享内存的访问

3.套接字 SOCKET：

socket 也是一种进程间通信机制，与其他通信机制不同的是，它可用于不同主机之间的进程通信。
